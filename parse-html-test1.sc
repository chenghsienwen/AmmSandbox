/*
sample response
ad { html_snippet: "<html><head>\n<meta charset=\"utf-8\"/>\n<meta name=\"viewport\" content=\"initial-scale=1.0, maximum-scale=1.0, user-scalable=no\" />\n<title>Quadas</title>\n    <style type=\"text/css\">\nhtml{font-size: 10px;}\nbody{margin:0;padding:0;font-size:63%;font-family:Arial,Helvetica,sans-serif,\"Microsoft YaHei\",\"Apple LiGothic Medium\",\"Segoe UI\";background:rgba(0, 0, 0, 0.8);\n-webkit-justify-content:center;justify-content:center;display:flex;display:-webkit-flex;text-align:center;align-items:center;-webkit-align-items:center;height: 100vh;\n}\n    \nbody{background-image:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACVJREFUeNpitLS0lJWVffz4MZBkDAsLY4ABJqAYkIKQKDIAAQYAVVMLXmMqHtMAAAAASUVORK5CYII=\");\nbackground-size:4px 4px;}\n    </style></head><body><script>document.write('<a href=\"%%CLICK_URL_UNESC%%https%3A%2F%2Fstg-c-dsp.vpon.com%2Fbeacon%3Ft%3D1%26cid%3Dd.hJ-u-tTKj91YocSPFwKBnJPT49HLtaYYga609t-kzoDPRxxSRURBQ1RFRCBGT1IgUFJJVkFDWSBSRUFTT05TBGMAx7Pw0ZdOu-QvPGEq.2503%26did%3D524544414354454420464F52205052495641435920524541534F4E53%26conv%3D%26rurl%3Dhttps%253A%252F%252Fwww.vpon.com%252F%26rand%3D%%CACHEBUSTER%%\" target=\"_blank\"><img width=\"320\" height=\"50\" src=\"https://s-img-dsp.vpadn.com/dsp-staging-console/0c/a07e9c522d2b8493ff970d1871d13b78d80f85.png\" style=\"border-style: none\"/></a>');</script></body></html>" adslot { id: 1 max_cpm_micros: 2000000 billing_id: 23716816037 deal_id: 900123456 } click_through_url: "https://www.vpon.com/" attribute: 47 buyer_creative_id: "6_40_1" width: 320 height: 50 impression_tracking_url: "https://stg-b-dsp.vpon.com/beacon?t=0&cid=d.hJ-u-tTKj91YocSPFwKBnJPT49HLtaYYga609t-kzoDPRxxSRURBQ1RFRCBGT1IgUFJJVkFDWSBSRUFTT05TBGMAx7Pw0ZdOu-QvPGEq.2503&rand=%%CACHEBUSTER%%" impression_tracking_url: "https://stg-google-adx.vpadn.com/winnotice?clickid=d.hJ-u-tTKj91YocSPFwKBnJPT49HLtaYYga609t-kzoDPRxxSRURBQ1RFRCBGT1IgUFJJVkFDWSBSRUFTT05TBGMAx7Pw0ZdOu-QvPGEq.2503&adid=70322071&served=true&price=%%WINNING_PRICE%%&did=524544414354454420464F52205052495641435920524541534F4E53" } processing_time_ms: 9

*/

import $ivy.`org.jsoup:jsoup:1.12.1`, org.jsoup._
import collection.JavaConverters._
import java.net.URLEncoder
import java.net.URLDecoder
val raw = """ad { html_snippet: "<html><head>\n<meta charset=\"utf-8\"/>\n<meta name=\"viewport\" content=\"initial-scale=1.0, maximum-scale=1.0, user-scalable=no\" />\n<title>Quadas</title>\n    <style type=\"text/css\">\nhtml{font-size: 10px;}\nbody{margin:0;padding:0;font-size:63%;font-family:Arial,Helvetica,sans-serif,\"Microsoft YaHei\",\"Apple LiGothic Medium\",\"Segoe UI\";background:rgba(0, 0, 0, 0.8);\n-webkit-justify-content:center;justify-content:center;display:flex;display:-webkit-flex;text-align:center;align-items:center;-webkit-align-items:center;height: 100vh;\n}\n    \nbody{background-image:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACVJREFUeNpitLS0lJWVffz4MZBkDAsLY4ABJqAYkIKQKDIAAQYAVVMLXmMqHtMAAAAASUVORK5CYII=\");\nbackground-size:4px 4px;}\n    </style></head><body><script>document.write('<a href=\"%%CLICK_URL_UNESC%%https%3A%2F%2Fstg-c-dsp.vpon.com%2Fbeacon%3Ft%3D1%26cid%3Dd.hJ-u-tTKj91YocSPFwKBnJPT49HLtaYYga609t-kzoDPRxxSRURBQ1RFRCBGT1IgUFJJVkFDWSBSRUFTT05TBGMAx7Pw0ZdOu-QvPGEq.2503%26did%3D524544414354454420464F52205052495641435920524541534F4E53%26conv%3D%26rurl%3Dhttps%253A%252F%252Fwww.vpon.com%252F%26rand%3D%%CACHEBUSTER%%\" target=\"_blank\"><img width=\"320\" height=\"50\" src=\"https://s-img-dsp.vpadn.com/dsp-staging-console/0c/a07e9c522d2b8493ff970d1871d13b78d80f85.png\" style=\"border-style: none\"/></a>');</script></body></html>" adslot { id: 1 max_cpm_micros: 2000000 billing_id: 23716816037 deal_id: 900123456 } click_through_url: "https://www.vpon.com/" attribute: 47 buyer_creative_id: "6_40_1" width: 320 height: 50 impression_tracking_url: "https://stg-b-dsp.vpon.com/beacon?t=0&cid=d.hJ-u-tTKj91YocSPFwKBnJPT49HLtaYYga609t-kzoDPRxxSRURBQ1RFRCBGT1IgUFJJVkFDWSBSRUFTT05TBGMAx7Pw0ZdOu-QvPGEq.2503&rand=%%CACHEBUSTER%%" impression_tracking_url: "https://stg-google-adx.vpadn.com/winnotice?clickid=d.hJ-u-tTKj91YocSPFwKBnJPT49HLtaYYga609t-kzoDPRxxSRURBQ1RFRCBGT1IgUFJJVkFDWSBSRUFTT05TBGMAx7Pw0ZdOu-QvPGEq.2503&adid=70322071&served=true&price=%%WINNING_PRICE%%&did=524544414354454420464F52205052495641435920524541534F4E53" } processing_time_ms: 9

"""
// val html = "<html><head>\n<meta charset=\"utf-8\"/>\n<meta name=\"viewport\" content=\"initial-scale=1.0, maximum-scale=1.0, user-scalable=no\" />\n<title>Quadas</title>\n    <style type=\"text/css\">\nhtml{font-size: 10px;}\nbody{margin:0;padding:0;font-size:63%;font-family:Arial,Helvetica,sans-serif,\"Microsoft YaHei\",\"Apple LiGothic Medium\",\"Segoe UI\";background:rgba(0, 0, 0, 0.8);\n-webkit-justify-content:center;justify-content:center;display:flex;display:-webkit-flex;text-align:center;align-items:center;-webkit-align-items:center;height: 100vh;\n}\n    \nbody{background-image:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACVJREFUeNpitLS0lJWVffz4MZBkDAsLY4ABJqAYkIKQKDIAAQYAVVMLXmMqHtMAAAAASUVORK5CYII=\");\nbackground-size:4px 4px;}\n    </style></head><body><script>document.write('<a href=\"%%CLICK_URL_UNESC%%https%3A%2F%2Fstg-c-dsp.vpon.com%2Fbeacon%3Ft%3D1%26cid%3Dd.hJ-u-tTKj91YocSPFwKBnJPT49HLtaYYga609t-kzoDPRxxSRURBQ1RFRCBGT1IgUFJJVkFDWSBSRUFTT05TBGMAx7Pw0ZdOu-QvPGEq.2503%26did%3D524544414354454420464F52205052495641435920524541534F4E53%26conv%3D%26rurl%3Dhttps%253A%252F%252Fwww.vpon.com%252F%26rand%3D%%CACHEBUSTER%%\" target=\"_blank\"><img width=\"320\" height=\"50\" src=\"https://s-img-dsp.vpadn.com/dsp-staging-console/0c/a07e9c522d2b8493ff970d1871d13b78d80f85.png\" style=\"border-style: none\"/></a>');</script></body></html>"

val doc = Jsoup.parse(raw) 
println(doc)
val text = doc.select("script").asScala.head.html
val url = text.split("%%").filter(i => i.contains("https")).head

println(text)
val clickUrl = URLDecoder.decode(url, "UTF-8")

println(clickUrl)
